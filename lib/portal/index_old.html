<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
    
	<title>Vision Zero</title>

    <link rel="stylesheet" type="text/css" href="lib/bootstrap-3.1.1-dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap-slider/css/bootstrap-slider.css">
    <link rel="stylesheet" href="http://js.arcgis.com/3.9/js/esri/css/esri.css">
	<link rel="stylesheet" href="http://js.arcgis.com/3.9/js/dojo/dijit/themes/claro/claro.css">
	<link href="lib/jqwidgets-ver3.3.0/jqwidgets/stylesjqx.base.css" rel="stylesheet">
    <link href="lib/jqwidgets-ver3.3.0/jqwidgets/stylesjqx.bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="fonts/icomoon/style.css">
    <link rel="stylesheet" type="text/css" href="css/zero.css">	
    
  <body>  
    <!--Start Black Bar-->
	<div id="blackBar" class="container-fluid">  
		<div class="blackBar">
			<div class="container">
				<span> 
				  <a href="http://www.nyc.gov/"><img src="img/logo/nyc.png" ></a> 
				  <img src="img/other/upper-header-divider.gif">
				  <span class="blackBarFont blackBarOff"></span> 
				</span>
				
				<span ></span>
				
				<span class="pull-right" >
					<span> <a class="blackBarFont blackBarOff" href="http://www1.nyc.gov/311/index.page">311</a> </span> 
					<img alt="" class="blackBarOff"src="img/other/upper-header-divider.gif">
					<span> <a class="blackBarFont blackBarOff" href="http://www1.nyc.gov/home/search/index.page">Search all NYC.gov websites</a> </span>  
				</span>
			</div>
		</div>
	</div> 
	<!--Black Bar End-->
	
	<!--Title Bar-->
	<div id="titleBar" class="container-fluid"> 
		<div>
		  <div class="titleBar">
				<div class="container">
				    <!--Buttons for small Screen Start-->
					<span>
						<button id="timeBtnSm" href="#timeSm" type="button" class="btn btn-default stayOff pull-left noBorder" data-toggle="collapse">
						  <span class="glyphicon glyphicon-calendar"></span> 
						</button>
					</span>
					
					<span>
						<button id="searchBtnSm" href="#searchSm" type="button" class="btn btn-default stayOff pull-right noBorder"  data-toggle="collapse">
						  <span class="glyphicon glyphicon-search"></span> 
						</button>
					</span>						
					<!--Buttons for small Screen End-->
					
					<span>
						<a  href="http://www.nyc.gov/html/visionzero/pages/home/home.shtml">
							<img id="logo-main" alt="Vision Zero" title="Vision Zero" src="img/logo/VisionZero.png" class="vzLogo img-responsive ">
						</a> 
					</span>
					
					<form  id="searchInput" class="pull-right col-md-4 blackBarOff" role="search" >
						
						<div class="form-group" style="display:inline;">
						  <div class="input-group input-group-sm" style="top:0.3em;" >
							
							<span id="searchBorough" class="input-group-addon dropdown-toggle" data-toggle="dropdown" style="background-color: rgba(255,255,255,1); background: rgba(255,255,255,1); color:#666666; border: 1px solid #D5D5D5; border-right:0px" >Boro<span class="caret"></span></span>
							  
							  <ul class="dropdown-menu">
								<li><a href="#">Manhattan</a></li>
								<li><a href="#">Bronx</a></li>
								<li><a href="#">Brooklyn</a></li>
								<li><a href="#">Queens</a></li>
								<li><a href="#">Staten Island</a></li>
								<li class="divider"></li>
								<li><a href="#">Zip Code</a></li>
								<li><a href="#">Police Precinct</a></li>
								<li><a href="#">Community Board</a></li>
								<li><a href="#">City Council District</a></li>
							  </ul>
							
							<input id="address" class="form-control" name="search" placeholder="Search" autocomplete="off" autofocus="autofocus" type="text" style="background-color: rgba(255,255,255,1); background: rgba(255,255,255,1); color:##D5D5D5; background-color: rgba(255,255,255,1); background: rgba(255,255,255,1); border: 1px solid #D5D5D5;">
							<span id="btnsearch" class="input-group-addon"style="background-color: rgba(255,255,255,1); background: rgba(255,255,255,1); border: 1px solid #D5D5D5; color:##D5D5D5; border-left:0px"><span class="glyphicon glyphicon-search"></span></span>
						  </div>
						</div>
					</form>
				</div>
		  </div>
		</div>
	</div> 
	<!--End Title Bar-->
		    	<!---- new buttons 6-19 toggle injury/fatality /// visible only in crash map --------------------->
          	<!--<div id='crashToggleBtn'></div>-->
          	<!--- new button end ------->
     
	
	<!--Side Menu Start-->
	<div id="slide-panel" >
		<a href="#" class="btn" id="opener"><i class="glyphicon glyphicon-align-justify"></i></a>
		<!--<div style="background-color:#FFFFFF; height:100%; width:1em; right:0px; float:right;">
		</div>
<!------------------- new June20 ----------------->
 	   <div id="menuGallery" class="container-fluid" style="background-color:#F3F7F8 !important; border-right:0.2em solid #CAC8C8 !important; margin-top: 0.5em;">
			<div >
				<!--<div style="width:100%; height:4em; background-color:#D5D9DB; top:-10px;"> 
					<h4 style="text-align:center; color:#1C8FCF;">Categories</h4>
				</div>-->
				<h3 style="text-align:center; color:#3494D1;">Injuries & Fatalities</h3>
				<!--<h4 style="text-align:left; color:#3494D1;">Who</h4>-->
				
				<div  class="btn-group btn-lg" data-toggle="buttons" style="margin-top:1em; margin-left:2em;">
					<label class="btn btn-default">
						<input type="radio" name="options" id="option1"><span style="font-family: 'icomoon'; font-size: 18px;">5</span>
					  </label>
					  <label class="btn btn-default">
						<input type="radio" name="options" id="option2"><span style="font-family: 'icomoon'; font-size: 18px;">2</span>
					  </label>
					  <label class="btn btn-default">
						<input type="radio" name="options" id="option3"><span style="font-family: 'icomoon'; font-size: 18px;">1</span>
					  </label>
					  <label class="btn btn-default active">
						<input type="radio" name="options" id="option3"><span style="font-family: 'icomoon'; font-size: 18px;">7</span>
						</label>
				
				</div>
				
				<!--<h4 style="text-align:left; color:#3494D1;">What</h4>-->
				<div id='crashToggleBtn'></div>
				<!--<h4 style="text-align:left; color:#3494D1; margin-top:2em;">When</h4>-->
				<div id='crashTimeToggleBtn'></div>
				
				<button class="btn btn-primary btn-lg center-block" data-toggle="modal" data-target="#myModal" style=" text-align:center; margin-top:3em;">
				  More Info
				</button>
			</div>
			<!------------------------------------------------------------------------------------------------------>
			<div>
				<!--<div style="position:relative; width:300 px; height:4em; background-color:#D5D9DB; top:-10px;"> 
					<h4 style="text-align:center; color:#1C8FCF;">Categories</h4>
				</div>-->
				<h3 style="text-align:center; color:#3494D1;">Safety Interventions</h3>
				
				<button class="btn btn-primary btn-lg center-block" data-toggle="modal" data-target="#myModal" style=" text-align:center; margin-top:3em;">
				  More Info
				</button>
			</div>
			
			<!------------------------------------------------------------------------------------------------------>
			<div>
				<!--<div style="position:relative; width:300 px; height:4em; background-color:#D5D9DB; top:-10px;"> 
					<h4 style="text-align:center; color:#1C8FCF;">Categories</h4>
				</div>-->
				<h3 style="text-align:center; color:#3494D1;">Outreach</h3>
				
				<button class="btn btn-primary btn-lg center-block" data-toggle="modal" data-target="#myModal" style=" text-align:center; margin-top:3em;">
				  More Info
				</button>
			</div>
			
			<!------------------------------------------------------------------------------------------------------>
			<div>
				<!--<div style="position:relative; width:300 px; height:4em; background-color:#D5D9DB; top:-10px;"> 
					<h4 style="text-align:center; color:#1C8FCF;">Categories</h4>
				</div>-->
				<h3 style="text-align:center; color:#3494D1;">Reference</h3>
				
				<button class="btn btn-primary btn-lg center-block" data-toggle="modal" data-target="#myModal" style=" text-align:center; margin-top:3em;">
				  More Info
				</button>
			</div>
			
			<div><div class="photo" style="background-image: url(img/testImgs/dog4.jpg)"></div></div>
		</div>
		
	
	</div>
	<!--Side  Menu End-->
	
	
	<!--Map Start-->
	<div id="map" class="container-fluid" > 
	</div>
	<!--Map End-->

	
	<!--Time Slider Start-->
	<div  id="sliderDiv" class="container-fluid">
	 	<div id='jqxslider'></div>
	</div>
	<!--Time Slider End-->

	
	
	<!--<div id="footer"  style="position: fixed; background-color:rgb(18,50,112); bottom: 0;  margin-left:1.2%; margin-right:1.2%; height: 4%; width: 97.6%; padding-left:10px; padding-right: 10px;">-->
    <div id="footer"  class="container-fluid"  style="position: fixed; background-color:#203970; bottom: 0; height: 2em; width: 100%; z-index:2001;"> 
	  <div class="container-fluid">
        <p class="footerFont pull-left">City of New York 2014 All Rights Reserved.</p>
			<span class="pull-right">
				<a href="#" class="socialMedia blackBarOff">3</a> <!-- facebook = !-->
				<a href="#" class="socialMedia blackBarOff">6</a> <!-- Twitter = $-->
				<a href="#" class="socialMedia blackBarOff">4</a> <!-- Google+ = "-->
			</span>
      </div>
    </div>

    <script src="http://js.arcgis.com/3.9/"></script>
    <script>
      
	  var map;
	  var arcgisserver = "www.sustainablestreets.info:6080";
	  
	  	  //////////////////
	  	  var layer, visibleLayerIds = [];
	  	  var crashLocationLayer, injuryLocationLayer;
	  	//  var fatalityLocations, injuryLocations;
	  	var fatality, injury; // new switches
	  	  var injHeat, fatalHeat;
	  	  var heatMap, pointMap;   //point=month, heat = year
	  	  var allInjIdentifyTask, allInjIdentifyParams, allFatIdentifyTask, allFatIdentifyParams, infoWindowPopup;
	  	  ////////////////
	  
	  
      require([
		"esri/map", 
		"esri/layers/ArcGISTiledMapServiceLayer",
		"esri/dijit/LocateButton",
		"esri/layers/ArcGISDynamicMapServiceLayer",
		"esri/tasks/IdentifyTask", "esri/tasks/IdentifyParameters",
		"esri/dijit/Popup", "esri/layers/FeatureLayer", "esri/InfoTemplate",
        "esri/layers/ImageParameters",
        "dojo/dom",
        "dojo/on",
        "dojo/query",
		"dojo/domReady!"
		],
        function(Map, Tiled, LocateButton, ArcGISDynamicMapServiceLayer, IdentifyTask, IdentifyParameters, Popup, FeatureLayer, InfoTemplate, ImageParameters, dom, on, query) {
		
		 var customExtentAndSR = new esri.geometry.Extent(-20037506,-9823074,20037506,10214431,new esri.SpatialReference({"wkid":4326}));
		// var layer, visibleLayerIds = []; // made global 6-03-2014 see above
		 
		 // new 6-03-2014 //
		 var crashLocations = false;
		 var isLayerAdded = true;
		 infoWindowPopup = new esri.dijit.Popup(null, dojo.create("div"));
		 // end new ////
		 
          map = new Map("map",{
			logo: false,
			center: [-72.994, 40.721], // longitude, latitude
			zoom: 1,
			sliderPosition: "top-right",
			sliderStyle: "small",
			extent: customExtentAndSR,
		  });

          var tiled = new Tiled("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_GAZETTEER/NYCDOTBasemap14AGrey/MapServer");
     //   var tiled = new Tiled("http://dotqavgisweb:6080/arcgis/rest/services/GAZETTEER/NYCDOTBasemap13DGrey/MapServer");
          map.addLayer(tiled);
		  
		  /*var tiled = new Tiled("http://www.sustainablestreets.info:6080/ArcGIS/rest/services/GISAPP_GAZETTEER/NYCDOTBasemap14AGrey/MapServer");
          map.addLayer(tiled);*/
          
          /////////////// new ////////////////////////////////
                  
          allFatalityLayer = new esri.layers.ArcGISDynamicMapServiceLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/monthlyTotalFatalities_Seth_2009_2014/MapServer", {
		// allFatalityLayer = new esri.layers.ArcGISDynamicMapServiceLayer("http://dotqavgisweb:6080/arcgis/rest/services/VISION_ZERO/allFatalities_monthly/MapServer", {
		 		id : "allFatalityLayer"

			});
			map.addLayer(allFatalityLayer);
			var testArray = []; testArray[0] = 0;
			allFatalityLayer.setVisibleLayers(testArray);
		 
		//  allInjuryLayer = new esri.layers.ArcGISDynamicMapServiceLayer("http://dotqavgisweb:6080/arcgis/rest/services/VISION_ZERO/allInjuries_monthly/MapServer", {
	  allInjuryLayer = new esri.layers.ArcGISDynamicMapServiceLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/monthlyInjuries_2009_2014_June13/MapServer", {
			id : "allInjuryLayer"

			});
			map.addLayer(allInjuryLayer);
			var allInjuryArray = []; allInjuryArray[0] = 0;
			allInjuryLayer.setVisibleLayers(allInjuryArray);
		
		
		////////////// new June 25 /////////////////////////////////////
		
			var allInjHeat09 = new esri.layers.FeatureLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/allInjury2009_heatMap/MapServer/0", {
				id : "allInjHeat09",
				mode : esri.layers.FeatureLayer.MODE_ONDEMAND
				//infoTemplate : infoTemplate1,
				//outFields : ["*"]// change here too for QA and cloud /////////////
			});
						var allInjHeat10 = new esri.layers.FeatureLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/allInjury2010_heatMap/MapServer/0", {
				id : "allInjHeat10",
				mode : esri.layers.FeatureLayer.MODE_ONDEMAND
				//infoTemplate : infoTemplate1,
				//outFields : ["*"]// change here too for QA and cloud /////////////
			});
						var allInjHeat11 = new esri.layers.FeatureLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/allInjury2011_heatMap/MapServer/0", {
				id : "allInjHeat11",
				mode : esri.layers.FeatureLayer.MODE_ONDEMAND
				//infoTemplate : infoTemplate1,
				//outFields : ["*"]// change here too for QA and cloud /////////////
			});
						var allInjHeat12 = new esri.layers.FeatureLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/allInjury2012_heatMap/MapServer/0", {
				id : "allInjHeat12",
				mode : esri.layers.FeatureLayer.MODE_ONDEMAND
				//infoTemplate : infoTemplate1,
				//outFields : ["*"]// change here too for QA and cloud /////////////
			});
						var allInjHeat13 = new esri.layers.FeatureLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/allInjury2013_heatMap/MapServer/0", {
				id : "allInjHeat13",
				mode : esri.layers.FeatureLayer.MODE_ONDEMAND
				//infoTemplate : infoTemplate1,
				//outFields : ["*"]// change here too for QA and cloud /////////////
			});
						var allInjHeat14 = new esri.layers.FeatureLayer("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/allInjury2014_heatMap/MapServer/0", {
				id : "llInjHeat14",
				mode : esri.layers.FeatureLayer.MODE_ONDEMAND
				//infoTemplate : infoTemplate1,
				//outFields : ["*"]// change here too for QA and cloud /////////////
			});
			
			
			////////////////////////////////////////// end new June 25 /////////////////////////////
		    $(document).ready(function () {
                $("#jqxslider").jqxSlider({
                    theme: 'orange',
                    value: 0,
                    min: 0,
                    max: 64,  // ticks until May 2014, will need updating
                    mode: "fixed",
                    step: 1,
                    ticksFrequency: 1,
                    tooltip: true
                });
              //  createTooltip();
                var upperTicks = $("#jqxslider .jqx-slider-tickscontainer:eq(0)").children();
                var lowerTicks = $("#jqxslider .jqx-slider-tickscontainer:eq(1)").children();
                for (var i = 0; i < upperTicks.length; i++) {
                    if (i % 12 !=0) {
                      //  $(upperTicks[i]).css("display", "none");
                        $(lowerTicks[i]).css("display", "none");
                    };
                }; 
			});
                
            $(document).ready(function () {
                // Create Push Button.
                $("#crashToggleBtn").jqxSwitchButton({  width: '85%', height: '40', checked: true, onLabel: "Fatalities", offLabel: "Injuries" });
                fatality = true;
               	$("#crashToggleBtn").bind('change', function (event) {
                    var isChecked = event.args.check; 
                    if (isChecked == true) { fatality = true; injury = false;}
                    else  {injury = true; fatality = false;}
                     addCrashLocations();
                });
            });
                
            $(document).ready(function(){
				addCrashLocations();
				allInjIdentifyParams = new esri.tasks.IdentifyParameters();
				allInjIdentifyParams.tolerance = 4;
				allInjIdentifyParams.returnGeometry = true;
				allInjIdentifyParams.layerOption = esri.tasks.IdentifyParameters.LAYER_OPTION_TOP;
				allInjIdentifyParams.width = map.width;
				allInjIdentifyParams.height = map.height;

				allFatIdentifyParams = new esri.tasks.IdentifyParameters();
				allFatIdentifyParams.tolerance = 4;
				allFatIdentifyParams.returnGeometry = true;
				allFatIdentifyParams.layerOption = esri.tasks.IdentifyParameters.LAYER_OPTION_TOP;
				allFatIdentifyParams.width = map.width;
				allFatIdentifyParams.height = map.height;

				allInjIdentifyTask = new esri.tasks.IdentifyTask("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/monthlyInjuries_2009_2014_June13/MapServer");
				allFatIdentifyTask = new esri.tasks.IdentifyTask("http://dotdevgisiis01/ArcGIS/rest/services/GISAPP_VISION_ZERO/monthlyTotalFatalities_Seth_2009_2014/MapServer");
				dojo.connect(map, "onClick", executeIdentifyTask);
			});
			
			$(document).ready(function () {
                // Create Push Button.
                $("#crashTimeToggleBtn").jqxSwitchButton({  width: '85%', height: '40', checked: true, onLabel: "By Month", offLabel: "By Year" });
                pointMap = true;
               	$("#crashToggleBtn").bind('change', function (event) {
                    var isChecked = event.args.check; 
                    if (isChecked == true) { pointMap = true; heatMap = false;map.infoWindow.hide();}
                    else  {heatMap = true; pointMap = false;map.infoWindow.hide();}
                     addCrashLocations();
                });
            });
 
			$(document).ready(function(){
				$('#menuGallery').jqxScrollView({ width: 600, height: 450, theme: 'summer', buttonsOffset: [0, 0] });
			});
			

			/*$(document).ready(function(){
                $('[data-slidepanel]').slidepanel({
					orientation: 'left',
					mode: 'push'
				});
			});*/
	});
    </script>
	<!---------------- new June17 - slider -------------------------->
	<link rel="stylesheet" href="lib/jqwidgets-ver3.3.0/jqwidgets/styles/jqx.base.css" type="text/css"/>
	
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
       <!-- <script type="text/javascript" src="js/jquery.slidepanel.js"></script>
    <link rel="stylesheet" type="text/css" href="css/jquery.slidepanel.css">-->
    
    <!--------------- new June17 - jqwidgets slider -------------->
	<script type="text/javascript" src="lib/jqwidgets-ver3.3.0/jqwidgets/jqxcore.js"></script>
	<script type="text/javascript" src="lib/jqwidgets-ver3.3.0/jqwidgets/jqxbuttons.js"></script>
	<script type="text/javascript" src="lib/jqwidgets-ver3.3.0/jqwidgets/jqxswitchbutton.js"></script>
	<script type="text/javascript" src="lib/jqwidgets-ver3.3.0/jqwidgets/jqxslider.js"></script>
	    <script type="text/javascript" src="lib/jqwidgets-ver3.3.0/scripts/gettheme.js"></script>
	    <script type="text/javascript" src="lib/jqwidgets-ver3.3.0/jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="lib/jqwidgets-ver3.3.0/jqwidgets/jqxscrollview.js"></script>
	<link rel="stylesheet" href="lib/jqwidgets-ver3.3.0/jqwidgets/styles/jqx.orange.css" type="text/css" />
	<!---------------------------->
    <script src="lib/bootstrap-3.1.1-dist/js/bootstrap.min.js"></script>
    
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
    
    <!--<script src="lib/bootstrap-slider/js/bootstrap-slider.js"></script>-->
	<script src="lib/Modernizer/modernizr.custom.02110.js"></script>
	<script type="text/javascript" src="js/classie.js"></script>
    <script type="text/javascript" src="js/zero.js"></script>
    <script type="text/javascript" src="js/crashLocationFuncs.js"></script>
    <script type="text/javascript" src="js/identifyTask.js"></script>
	
  </body>
</html>
